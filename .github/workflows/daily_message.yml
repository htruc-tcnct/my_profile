name: Update Daily Messages

# Cháº¡y hÃ ng ngÃ y vÃ o lÃºc 00:05 UTC (khoáº£ng 7:05 sÃ¡ng Viá»‡t Nam)
# Báº¡n cÃ³ thá»ƒ thay Ä‘á»•i giá» cháº¡y theo Ã½ muá»‘n (xem cÃº phÃ¡p cron)
on:
  schedule:
    - cron: '5 0 * * *' # 00:05 UTC daily
  # Cho phÃ©p cháº¡y thá»§ cÃ´ng tá»« tab Actions trÃªn GitHub
  workflow_dispatch:

jobs:
  update_messages:
    runs-on: ubuntu-latest # Cháº¡y trÃªn mÃ¡y áº£o Ubuntu má»›i nháº¥t
    permissions:
      contents: write # Cáº¥p quyá»n cho Action Ä‘á»ƒ ghi vÃ o repo (commit & push)

    steps:
      # BÆ°á»›c 1: Checkout code tá»« repository vá» mÃ¡y áº£o runner
      - name: Checkout repository
        uses: actions/checkout@v4

      # BÆ°á»›c 2: Thiáº¿t láº­p mÃ´i trÆ°á»ng Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10' # Chá»n phiÃªn báº£n Python

      # BÆ°á»›c 3: CÃ i Ä‘áº·t cÃ¡c thÆ° viá»‡n Python cáº§n thiáº¿t
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install google-generativeai

      # BÆ°á»›c 4: Cháº¡y script Python Ä‘á»ƒ cáº­p nháº­t file messages.json
      - name: Run script to update messages
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }} # Truyá»n API Key tá»« Secret vÃ o script
        run: python update_messages.py

      # BÆ°á»›c 5: Commit vÃ  Push thay Ä‘á»•i vÃ o repository
      - name: Commit and push changes
        run: |
          git config --global user.name 'github-actions[bot]' # TÃªn user commit
          git config --global user.email 'github-actions[bot]@users.noreply.github.com' # Email user commit
          # Chá»‰ commit náº¿u file messages.json thá»±c sá»± thay Ä‘á»•i
          git diff --quiet messages.json || (git add messages.json && git commit -m "ğŸ“ Cáº­p nháº­t thÃ´ng Ä‘iá»‡p hÃ ng ngÃ y tá»± Ä‘á»™ng" && git push)
          echo "Commit and push step completed."